"use strict";var t,e=t=>{throw TypeError(t)},i=(t,i,s)=>(((t,i,s)=>{i.has(t)||e("Cannot "+s)})(t,i,"read from private field"),s?s.call(t):i.get(t));Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class s{constructor(){var i,s,n;i=this,s=t,n=new Map,s.has(i)?e("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(i):s.set(i,n)}on(e,s){return i(this,t).has(e)||i(this,t).set(e,new Set),i(this,t).get(e).add(s),()=>this.off(e,s)}once(t,e){const i=(...s)=>{this.off(t,i),e(...s)};return i._original=e,this.on(t,i)}off(e,s){const n=i(this,t).get(e);if(n){n.delete(s);for(const t of n)t._original===s&&n.delete(t);0===n.size&&i(this,t).delete(e)}}emit(e,...s){const n=i(this,t).get(e);if(n)for(const t of n)t(...s);const r=i(this,t).get("*");if(r)for(const t of r)t(e,...s)}removeAllListeners(e){e?i(this,t).delete(e):i(this,t).clear()}listenerCount(e){var s;return(null==(s=i(this,t).get(e))?void 0:s.size)??0}}function n(t){const e=new Float32Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i]/32768;return e}function r(t,e=!1){let i=0;const s=t.length;if(0===s)return 0;for(let n=0;n<s;n++){const s=e?(t[n]-128)/128:t[n];i+=s*s}return Math.sqrt(i/s)}function o(t,e,i){const s=i||[{name:"sub",min:20,max:200},{name:"low",min:200,max:800},{name:"mid",min:800,max:2500},{name:"high",min:2500,max:5500},{name:"veryHigh",min:5500,max:12e3}],n=t.length,r=e/2/n,o={};for(const a of s){const e=Math.max(0,Math.floor(a.min/r)),i=Math.min(n-1,Math.floor(a.max/r));if(e>=i){o[a.name]=0;continue}let s=0,h=0;for(let n=e;n<=i;n++)s+=t[n]/255,h++;o[a.name]=h>0?s/h:0}return o}function a(t,e,i){return t+(e-t)*(1-i)}function h(t,e,i){return Math.max(e,Math.min(i,t))}function l(t,e,i){if(e===i)return t;const s=e/i,n=Math.round(t.length/s),r=new Float32Array(n);for(let o=0;o<n;o++){const e=o*s,i=Math.floor(e),n=Math.min(i+1,t.length-1),a=e-i;r[o]=t[i]*(1-a)+t[n]*a}return r}t=new WeakMap;const d={sil:{label:"Silent",description:"Mouth closed, neutral"},PP:{label:"P/B/M",description:"Lips pressed together"},FF:{label:"F/V",description:"Lower lip to upper teeth"},TH:{label:"TH",description:"Tongue between teeth"},DD:{label:"D/T/N/L",description:"Tongue to upper palate"},kk:{label:"K/G",description:"Back of tongue raised"},CH:{label:"CH/SH/J",description:"Lips pursed forward"},SS:{label:"S/Z",description:"Teeth close, slight smile"},nn:{label:"N/NG",description:"Mouth slightly open, nasal"},RR:{label:"R",description:"Lips slightly rounded"},aa:{label:"AA/AH",description:"Wide open mouth"},E:{label:"EH/AE",description:"Mouth open, slight smile"},I:{label:"IH/IY",description:"Small opening, smile"},O:{label:"OH/AO",description:"Rounded, medium open"},U:{label:"UW/OW",description:"Small rounded opening"}},u=Object.keys(d),c={A:{label:"Rest / M/B/P closed",extendedMap:["sil"]},B:{label:"M / B / P",extendedMap:["PP","nn"]},C:{label:"EE / S / soft sounds",extendedMap:["E","I","SS"]},D:{label:"AH / wide open",extendedMap:["aa","DD","kk"]},E:{label:"OH / round",extendedMap:["O","RR","CH"]},F:{label:"OO / F / V / tight",extendedMap:["FF","TH","U"]}},p=Object.keys(c),m={};for(const[M,P]of Object.entries(c))for(const t of P.extendedMap)m[t]=M;const f={AA:"aa",AE:"E",AH:"aa",AO:"O",AW:"aa",AY:"aa",EH:"E",ER:"RR",EY:"E",IH:"I",IY:"I",OW:"O",OY:"O",UH:"U",UW:"U",B:"PP",CH:"CH",D:"DD",DH:"TH",F:"FF",G:"kk",HH:"aa",JH:"CH",K:"kk",L:"DD",M:"PP",N:"nn",NG:"nn",P:"PP",R:"RR",S:"SS",SH:"CH",T:"DD",TH:"TH",V:"FF",W:"U",Y:"I",Z:"SS",ZH:"CH"},y=Object.keys(f),_={sil:{aa:.3,E:.3,I:.3,O:.3,U:.3,PP:.2,FF:.2},aa:{sil:.4,E:.5,O:.6,I:.5,PP:.3,SS:.3},PP:{aa:.2,sil:.2,E:.3,FF:.4},FF:{aa:.3,PP:.4,sil:.2},SS:{sil:.2,aa:.3,CH:.6}};function g(t,e){var i;return(null==(i=_[t])?void 0:i[e])??.35}const b={sil:{open:0,width:.5,round:0},PP:{open:0,width:.4,round:0},FF:{open:.05,width:.55,round:0},TH:{open:.1,width:.5,round:0},DD:{open:.2,width:.5,round:0},kk:{open:.25,width:.45,round:0},CH:{open:.15,width:.35,round:.6},SS:{open:.05,width:.6,round:0},nn:{open:.15,width:.5,round:0},RR:{open:.2,width:.4,round:.4},aa:{open:.9,width:.6,round:0},E:{open:.5,width:.65,round:0},I:{open:.25,width:.7,round:0},O:{open:.6,width:.4,round:.8},U:{open:.2,width:.3,round:.9}};const v={fftSize:256,silenceThreshold:.015,smoothingFactor:.35,holdFrames:2,intensitySmoothing:.2,energySmoothing:.5};class S{constructor(t,e,i={}){this.analyser=t,this.sampleRate=e,this.opts={...v,...i},this.analyser.fftSize=this.opts.fftSize,this.analyser.smoothingTimeConstant=this.opts.energySmoothing,this.timeDomainData=new Uint8Array(this.analyser.fftSize),this.frequencyData=new Uint8Array(this.analyser.frequencyBinCount),this._currentViseme="sil",this._currentIntensity=0,this._holdCounter=0,this._smoothedAmplitude=0,this._smoothedBands={sub:0,low:0,mid:0,high:0,veryHigh:0},this._previousViseme="sil",this._transitionProgress=1,this._frameCount=0}analyze(){this._frameCount++,this.analyser.getByteTimeDomainData(this.timeDomainData),this.analyser.getByteFrequencyData(this.frequencyData);const t=r(this.timeDomainData,!0);this._smoothedAmplitude=a(this._smoothedAmplitude,t,this.opts.smoothingFactor);const e=o(this.frequencyData,this.sampleRate);for(const r of Object.keys(e))this._smoothedBands[r]=a(this._smoothedBands[r]||0,e[r],this.opts.smoothingFactor);const i=this._smoothedBands;if(this._smoothedAmplitude<this.opts.silenceThreshold)return this._emitViseme("sil",0,i);const s=h(3*this._smoothedAmplitude,0,1),{viseme:n,confidence:l}=this._classifyViseme(i,s);if(n!==this._currentViseme){if(this._holdCounter++,this._holdCounter<this.opts.holdFrames)return this._emitViseme(this._currentViseme,s,i);this._holdCounter=0}else this._holdCounter=0;return this._emitViseme(n,s,i,l)}_classifyViseme(t,e){const{sub:i,low:s,mid:n,high:r,veryHigh:o}=t,a=i+s+n+r+o;if(a<.01)return{viseme:"sil",confidence:.9};const h=(r+o)/(a+.001);if(h>.55&&r>.15)return o>.8*r?{viseme:"SS",confidence:h}:{viseme:"CH",confidence:.85*h};const l=(n+r)/(a+.001);if(l>.5&&r>.1&&s<.15)return{viseme:"FF",confidence:.8*l};const d=1-Math.abs(r-s)/(a+.001);return e>.6&&d>.7&&this._smoothedAmplitude>.08?s>n?{viseme:"PP",confidence:.6}:{viseme:"DD",confidence:.6}:i>.2&&s>.15&&r<.08&&n<.7*s?{viseme:"nn",confidence:.65}:s>.2&&n>.15&&e>.5?{viseme:"aa",confidence:.7}:n>s&&n>.15&&e>.3?{viseme:"E",confidence:.65}:i>n&&s>n&&e>.3?{viseme:"O",confidence:.6}:n>.1&&r>.5*s&&e>.2?{viseme:"I",confidence:.55}:i>.15&&r<.05?{viseme:"U",confidence:.5}:e>.5?{viseme:"aa",confidence:.4}:e>.3?{viseme:"E",confidence:.35}:e>.15?{viseme:"I",confidence:.3}:{viseme:"sil",confidence:.5}}_emitViseme(t,e,i,s=.5){if(t!==this._currentViseme)this._previousViseme=this._currentViseme,this._currentViseme=t,this._transitionProgress=0;else{const t=g(this._previousViseme,this._currentViseme);this._transitionProgress=Math.min(1,this._transitionProgress+.3*(1-t))}this._currentIntensity=a(this._currentIntensity,e,this.opts.intensitySmoothing);const n=b[this._previousViseme]||b.sil,r=b[this._currentViseme]||b.sil,o=this._transitionProgress;return{viseme:this._currentViseme,simpleViseme:m[this._currentViseme]||"A",intensity:this._currentIntensity,confidence:s,amplitude:this._smoothedAmplitude,bands:{...this._smoothedBands},shape:{open:n.open+(r.open-n.open)*o,width:n.width+(r.width-n.width)*o,round:n.round+(r.round-n.round)*o},transition:{from:this._previousViseme,to:this._currentViseme,progress:this._transitionProgress},frame:this._frameCount}}reset(){this._currentViseme="sil",this._currentIntensity=0,this._holdCounter=0,this._smoothedAmplitude=0,this._smoothedBands={sub:0,low:0,mid:0,high:0,veryHigh:0},this._previousViseme="sil",this._transitionProgress=1,this._frameCount=0}}const w={sampleRate:24e3,fftSize:256,analyserSmoothing:.5,silenceThreshold:.015,smoothingFactor:.35,holdFrames:2,intensitySmoothing:.2,volume:1,startThresholdMs:50,bufferSeconds:5,analysisMode:"raf",analysisIntervalMs:16,workletUrl:null,disablePlayback:!1};exports.ARPABET_PHONEMES=y,exports.CSSClassRenderer=class{constructor(t,e={}){this.element=t,this.opts={attribute:"data-viseme",classPrefix:"",useSimpleVisemes:!1,intensityAttribute:"data-intensity",setIntensity:!0,visemeClassMap:null,...e},this._currentClass=null,this._currentViseme=null}render(t){var e,i,s,n;const r=this.opts.useSimpleVisemes?t.simpleViseme:t.viseme;if(r!==this._currentViseme){if(this.element.setAttribute(this.opts.attribute,r),this.opts.classPrefix){this._currentClass&&this.element.classList.remove(this._currentClass);const t=null==(e=this.opts.visemeClassMap)?void 0:e[r];this._currentClass=t||`${this.opts.classPrefix}${r}`,this.element.classList.add(this._currentClass)}this._currentViseme=r}if(this.opts.setIntensity){const e=Math.round(100*t.intensity);this.element.setAttribute(this.opts.intensityAttribute,e),this.element.style.setProperty("--lip-intensity",t.intensity),this.element.style.setProperty("--lip-open",(null==(i=t.shape)?void 0:i.open)??0),this.element.style.setProperty("--lip-width",(null==(s=t.shape)?void 0:s.width)??.5),this.element.style.setProperty("--lip-round",(null==(n=t.shape)?void 0:n.round)??0)}}destroy(){this._currentClass&&this.element.classList.remove(this._currentClass),this.element.removeAttribute(this.opts.attribute),this.element.removeAttribute(this.opts.intensityAttribute),this._currentViseme=null}},exports.CanvasRenderer=class{constructor(t,e){this.canvas=t,this.ctx=t.getContext("2d"),this.opts={offsetX:0,offsetY:0,scale:1,clearBeforeRender:!0,...e},this.spriteSheet=null,this._ready=!1,this._currentFrame=0,this._targetFrame=0,this._blendProgress=1,this._loadSpriteSheet(e.spriteSheet)}async _loadSpriteSheet(t){t instanceof HTMLImageElement?(this.spriteSheet=t,t.complete||await new Promise(e=>{t.onload=e}),this._ready=!0):"string"==typeof t&&(this.spriteSheet=new Image,this.spriteSheet.src=t,await new Promise((t,e)=>{this.spriteSheet.onload=t,this.spriteSheet.onerror=e}),this._ready=!0),!this.opts.columns&&this.spriteSheet&&(this.opts.columns=Math.floor(this.spriteSheet.naturalWidth/this.opts.frameWidth))}render(t){if(!this._ready||!this.spriteSheet)return;const e=this.opts.visemeMap[t.viseme]??this.opts.visemeMap.sil??0,i=this.opts.columns||1,s=Math.floor(e/i),n=e%i*this.opts.frameWidth,r=s*this.opts.frameHeight;this.opts.clearBeforeRender&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const o=this.opts.frameWidth*this.opts.scale,a=this.opts.frameHeight*this.opts.scale;this.ctx.drawImage(this.spriteSheet,n,r,this.opts.frameWidth,this.opts.frameHeight,this.opts.offsetX,this.opts.offsetY,o,a)}destroy(){this.spriteSheet=null,this._ready=!1}},exports.EXTENDED_TO_SIMPLE=m,exports.EXTENDED_VISEMES=d,exports.EXTENDED_VISEME_KEYS=u,exports.EventEmitter=s,exports.FrequencyAnalyzer=S,exports.LipSyncEngine=class extends s{constructor(t={}){super(),this.opts={...w,...t},this.audioContext=null,this.workletNode=null,this.analyserNode=null,this.gainNode=null,this.analyzer=null,this._mediaSource=null,this._elementSource=null,this._initialized=!1,this._analyzing=!1,this._animFrameId=null,this._intervalId=null,this._inputMode=null,this._playbackTimeMs=0,this._bufferLevel=0,this._destroyed=!1}async init(t){if(this._initialized)return;if(this._destroyed)throw new Error("Engine has been destroyed");this.audioContext=t||new AudioContext({sampleRate:this.opts.sampleRate}),"suspended"===this.audioContext.state&&await this.audioContext.resume();const e=this.opts.workletUrl||this._resolveWorkletUrl();await this.audioContext.audioWorklet.addModule(e),this.workletNode=new AudioWorkletNode(this.audioContext,"streaming-processor",{processorOptions:{sampleRate:this.opts.sampleRate,bufferSeconds:this.opts.bufferSeconds,startThresholdMs:this.opts.startThresholdMs}}),this.analyserNode=this.audioContext.createAnalyser(),this.analyserNode.fftSize=this.opts.fftSize,this.analyserNode.smoothingTimeConstant=this.opts.analyserSmoothing,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=this.opts.volume,this.workletNode.connect(this.analyserNode),this.opts.disablePlayback||(this.analyserNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination)),this.analyzer=new S(this.analyserNode,this.audioContext.sampleRate,{fftSize:this.opts.fftSize,silenceThreshold:this.opts.silenceThreshold,smoothingFactor:this.opts.smoothingFactor,holdFrames:this.opts.holdFrames,intensitySmoothing:this.opts.intensitySmoothing}),this.workletNode.port.onmessage=t=>this._onWorkletMessage(t.data),this._initialized=!0,this._inputMode="stream",this.emit("initialized")}_resolveWorkletUrl(){return"./streaming-processor.js"}feedAudio(t,e){let i;if(this._ensureInitialized(),t instanceof Int16Array)i=n(t);else if(t instanceof Float32Array)i=t;else if(t instanceof ArrayBuffer)i=n(new Int16Array(t));else{if(!ArrayBuffer.isView(t))throw new TypeError("feedAudio expects Int16Array, Float32Array, or ArrayBuffer");i=n(new Int16Array(t.buffer))}const s=e||this.opts.sampleRate;s!==this.audioContext.sampleRate&&(i=l(i,s,this.audioContext.sampleRate)),this.workletNode.port.postMessage({type:"audio",samples:i},[i.buffer])}attachStream(t){this._ensureInitialized(),this._disconnectSources(),this._mediaSource=this.audioContext.createMediaStreamSource(t),this._mediaSource.connect(this.analyserNode),this._inputMode="media",this.emit("sourceAttached",{type:"stream"})}attachElement(t){this._ensureInitialized(),this._disconnectSources(),this._elementSource=this.audioContext.createMediaElementSource(t),this._elementSource.connect(this.analyserNode),this.analyserNode.connect(this.audioContext.destination),this._inputMode="element",this.emit("sourceAttached",{type:"element"})}_disconnectSources(){if(this._mediaSource){try{this._mediaSource.disconnect()}catch{}this._mediaSource=null}if(this._elementSource){try{this._elementSource.disconnect()}catch{}this._elementSource=null}}startAnalysis(){this._analyzing||(this._ensureInitialized(),this._analyzing=!0,"raf"===this.opts.analysisMode?this._startRAFLoop():this._startIntervalLoop(),this.emit("analysisStarted"))}stopAnalysis(){this._analyzing=!1,null!==this._animFrameId&&(cancelAnimationFrame(this._animFrameId),this._animFrameId=null),null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null),this.emit("analysisStopped")}_startRAFLoop(){const t=()=>{this._analyzing&&(this._analyzeFrame(),this._animFrameId=requestAnimationFrame(t))};this._animFrameId=requestAnimationFrame(t)}_startIntervalLoop(){this._intervalId=setInterval(()=>{this._analyzing&&this._analyzeFrame()},this.opts.analysisIntervalMs)}_analyzeFrame(){const t=this.analyzer.analyze();t.timeMs=this._playbackTimeMs,t.bufferLevel=this._bufferLevel,this.emit("viseme",t)}_onWorkletMessage(t){switch(t.type){case"position":this._playbackTimeMs=t.timeMs,this._bufferLevel=t.bufferLevel,this.emit("position",{timeMs:t.timeMs,bufferLevel:t.bufferLevel,bufferMs:t.bufferMs,isPlaying:t.isPlaying});break;case"playbackStarted":this.emit("playbackStarted");break;case"playbackEnded":this.emit("playbackEnded");break;case"bufferUnderrun":this.emit("bufferUnderrun",{timeMs:t.timeMs});break;case"bufferOverflow":this.emit("bufferOverflow",{dropped:t.dropped});break;case"ready":this.emit("workletReady")}}setVolume(t){var e;const i=Math.max(0,Math.min(1,t));this.gainNode&&this.gainNode.gain.setTargetAtTime(i,this.audioContext.currentTime,.02),null==(e=this.workletNode)||e.port.postMessage({type:"setVolume",value:i})}clearBuffer(){var t;null==(t=this.workletNode)||t.port.postMessage({type:"clear"})}play(){var t;null==(t=this.workletNode)||t.port.postMessage({type:"start"})}pause(){var t;null==(t=this.workletNode)||t.port.postMessage({type:"stop"})}reset(){var t,e;null==(t=this.workletNode)||t.port.postMessage({type:"reset"}),null==(e=this.analyzer)||e.reset(),this._playbackTimeMs=0,this._bufferLevel=0,this.emit("reset")}get initialized(){return this._initialized}get analyzing(){return this._analyzing}get playbackTimeMs(){return this._playbackTimeMs}get bufferLevel(){return this._bufferLevel}get inputMode(){return this._inputMode}getState(){var t,e;return{initialized:this._initialized,analyzing:this._analyzing,inputMode:this._inputMode,playbackTimeMs:this._playbackTimeMs,bufferLevel:this._bufferLevel,sampleRate:null==(t=this.audioContext)?void 0:t.sampleRate,volume:null==(e=this.gainNode)?void 0:e.gain.value}}destroy(){var t,e,i,s,n;if(!this._destroyed){this._destroyed=!0,this.stopAnalysis(),this._disconnectSources();try{null==(t=this.workletNode)||t.disconnect()}catch{}try{null==(e=this.analyserNode)||e.disconnect()}catch{}try{null==(i=this.gainNode)||i.disconnect()}catch{}"closed"!==(null==(s=this.audioContext)?void 0:s.state)&&(null==(n=this.audioContext)||n.close().catch(()=>{})),this.workletNode=null,this.analyserNode=null,this.gainNode=null,this.analyzer=null,this.audioContext=null,this._initialized=!1,this.removeAllListeners(),this.emit("destroyed")}}_ensureInitialized(){if(!this._initialized)throw new Error("LipSyncEngine not initialized. Call init() first.")}},exports.PHONEME_TO_VISEME=f,exports.RingBuffer=class{constructor(t){this.buffer=new Float32Array(t),this.capacity=t,this.readPtr=0,this.writePtr=0,this.available=0}get length(){return this.available}get free(){return this.capacity-this.available}get empty(){return 0===this.available}get full(){return this.available===this.capacity}get level(){return this.available/this.capacity}write(t){const e=Math.min(t.length,this.free);for(let i=0;i<e;i++)this.buffer[this.writePtr]=t[i],this.writePtr=(this.writePtr+1)%this.capacity;return this.available+=e,e}writeOverflow(t){let e=0;for(let i=0;i<t.length;i++)this.available>=this.capacity?(this.readPtr=(this.readPtr+1)%this.capacity,e++):this.available++,this.buffer[this.writePtr]=t[i],this.writePtr=(this.writePtr+1)%this.capacity;return e}read(t,e=0,i){const s=Math.min(i??t.length-e,this.available);for(let n=0;n<s;n++)t[e+n]=this.buffer[this.readPtr],this.readPtr=(this.readPtr+1)%this.capacity;return this.available-=s,s}readOne(){if(0===this.available)return 0;const t=this.buffer[this.readPtr];return this.readPtr=(this.readPtr+1)%this.capacity,this.available--,t}peek(t){const e=Math.min(t,this.available),i=new Float32Array(e);let s=this.readPtr;for(let n=0;n<e;n++)i[n]=this.buffer[s],s=(s+1)%this.capacity;return i}clear(){this.readPtr=0,this.writePtr=0,this.available=0}},exports.SIMPLE_VISEMES=c,exports.SIMPLE_VISEME_KEYS=p,exports.SVGMouthRenderer=class{constructor(t,e={}){this.container=t,this.opts={width:120,height:80,lipColor:"#cc4444",innerColor:"#3a1111",teethColor:"#ffffff",showTeeth:!0,lipThickness:3,...e},this._createSVG(),this._lastShape={open:0,width:.5,round:0}}_createSVG(){const t="http://www.w3.org/2000/svg",{width:e,height:i}=this.opts;this.svg=document.createElementNS(t,"svg"),this.svg.setAttribute("viewBox",`0 0 ${e} ${i}`),this.svg.setAttribute("width",e),this.svg.setAttribute("height",i),this.svg.style.overflow="visible",this.innerPath=document.createElementNS(t,"path"),this.innerPath.setAttribute("fill",this.opts.innerColor),this.teethPath=document.createElementNS(t,"path"),this.teethPath.setAttribute("fill",this.opts.teethColor),this.teethPath.setAttribute("opacity","0.9"),this.lipPath=document.createElementNS(t,"path"),this.lipPath.setAttribute("fill","none"),this.lipPath.setAttribute("stroke",this.opts.lipColor),this.lipPath.setAttribute("stroke-width",this.opts.lipThickness),this.lipPath.setAttribute("stroke-linecap","round"),this.lipPath.setAttribute("stroke-linejoin","round"),this.svg.appendChild(this.innerPath),this.opts.showTeeth&&this.svg.appendChild(this.teethPath),this.svg.appendChild(this.lipPath),this.container.appendChild(this.svg),this._renderShape({open:0,width:.5,round:0})}render(t){t.shape&&this._renderShape(t.shape,t.intensity)}_renderShape(t,e=.5){const{width:i,height:s}=this.opts,n=i/2,r=s/2,o=.3*i+.5*i*t.width*(1-.4*t.round),a=Math.max(1,.7*s*t.open);t.round;const h=o/2,l=a/2,d=h*(.6+.3*t.round),u=l*(.8+.2*t.open),c=[`M ${n-h} ${r}`,`C ${n-d} ${r-u}, ${n+d} ${r-u}, ${n+h} ${r}`].join(" "),p=[`M ${n-h} ${r}`,`C ${n-d} ${r+u}, ${n+d} ${r+u}, ${n+h} ${r}`].join(" ");if(this.lipPath.setAttribute("d",`${c} ${p}`),t.open>.02){const e=.85,i=h*e,s=d*e,o=u*e,a=[`M ${n-i} ${r}`,`C ${n-s} ${r-o}, ${n+s} ${r-o}, ${n+i} ${r}`,`C ${n+s} ${r+o}, ${n-s} ${r+o}, ${n-i} ${r}`,"Z"].join(" ");this.innerPath.setAttribute("d",a),this.innerPath.setAttribute("opacity",Math.min(1,2*t.open))}else this.innerPath.setAttribute("d",""),this.innerPath.setAttribute("opacity","0");if(this.opts.showTeeth&&t.open>.1){const e=.7*h,i=Math.min(.3*l,8),s=r-.3*l,o=[`M ${n-e} ${s}`,`Q ${n} ${s+i}, ${n+e} ${s}`,`L ${n+e} ${s+.5*i}`,`Q ${n} ${s+1.3*i}, ${n-e} ${s+.5*i}`,"Z"].join(" ");this.teethPath.setAttribute("d",o),this.teethPath.setAttribute("opacity",Math.min(.9,1.5*t.open))}else this.teethPath.setAttribute("d",""),this.teethPath.setAttribute("opacity","0");this._lastShape={...t}}updateOptions(t){Object.assign(this.opts,t),t.lipColor&&this.lipPath.setAttribute("stroke",t.lipColor),t.innerColor&&this.innerPath.setAttribute("fill",t.innerColor),t.teethColor&&this.teethPath.setAttribute("fill",t.teethColor),t.lipThickness&&this.lipPath.setAttribute("stroke-width",t.lipThickness)}destroy(){var t;null==(t=this.svg)||t.remove(),this.svg=null}},exports.TRANSITION_WEIGHTS=_,exports.VERSION="1.0.0",exports.VISEME_SHAPES=b,exports.base64ToInt16=function(t){const e=atob(t),i=new Uint8Array(e.length);for(let s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return new Int16Array(i.buffer)},exports.calculateRMS=r,exports.clamp=h,exports.extractBandEnergies=o,exports.float32ToInt16=function(t){const e=new Int16Array(t.length);for(let i=0;i<t.length;i++){const s=Math.max(-1,Math.min(1,t[i]));e[i]=s<0?32768*s:32767*s}return e},exports.getTransitionWeight=g,exports.int16ToBase64=function(t){const e=new Uint8Array(t.buffer);let i="";for(let s=0;s<e.length;s++)i+=String.fromCharCode(e[s]);return btoa(i)},exports.int16ToFloat32=n,exports.interpolateShapes=function(t,e,i){const s=b[t]||b.sil,n=b[e]||b.sil,r=Math.max(0,Math.min(1,i));return{open:s.open+(n.open-s.open)*r,width:s.width+(n.width-s.width)*r,round:s.round+(n.round-s.round)*r}},exports.lerp=function(t,e,i){return t+(e-t)*Math.max(0,Math.min(1,i))},exports.resample=l,exports.smoothValue=a,exports.zeroCrossingRate=function(t){if(t.length<2)return 0;let e=0;for(let i=1;i<t.length;i++)(t[i]>=0&&t[i-1]<0||t[i]<0&&t[i-1]>=0)&&e++;return e/(t.length-1)};
//# sourceMappingURL=lipsync-engine.cjs.map
