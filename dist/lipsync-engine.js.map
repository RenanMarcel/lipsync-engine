{"version":3,"file":"lipsync-engine.js","sources":["../src/utils/EventEmitter.js","../src/utils/audio-utils.js","../src/core/visemes.js","../src/analyzers/FrequencyAnalyzer.js","../src/core/LipSyncEngine.js","../src/renderers/SVGMouthRenderer.js","../src/renderers/CanvasRenderer.js","../src/renderers/CSSClassRenderer.js","../src/utils/RingBuffer.js","../src/index.js"],"sourcesContent":["/**\n * Lightweight typed event emitter with wildcard support.\n * @module EventEmitter\n */\nexport class EventEmitter {\n  /** @type {Map<string, Set<Function>>} */\n  #listeners = new Map();\n\n  /**\n   * Subscribe to an event.\n   * @param {string} event - Event name, or '*' for all events.\n   * @param {Function} fn - Callback receiving (...args).\n   * @returns {() => void} Unsubscribe function.\n   */\n  on(event, fn) {\n    if (!this.#listeners.has(event)) {\n      this.#listeners.set(event, new Set());\n    }\n    this.#listeners.get(event).add(fn);\n    return () => this.off(event, fn);\n  }\n\n  /**\n   * Subscribe to an event once.\n   * @param {string} event\n   * @param {Function} fn\n   * @returns {() => void}\n   */\n  once(event, fn) {\n    const wrapper = (...args) => {\n      this.off(event, wrapper);\n      fn(...args);\n    };\n    wrapper._original = fn;\n    return this.on(event, wrapper);\n  }\n\n  /**\n   * Unsubscribe from an event.\n   * @param {string} event\n   * @param {Function} fn\n   */\n  off(event, fn) {\n    const set = this.#listeners.get(event);\n    if (!set) return;\n    set.delete(fn);\n    // Also remove `once` wrappers\n    for (const listener of set) {\n      if (listener._original === fn) {\n        set.delete(listener);\n      }\n    }\n    if (set.size === 0) this.#listeners.delete(event);\n  }\n\n  /**\n   * Emit an event.\n   * @param {string} event\n   * @param  {...any} args\n   */\n  emit(event, ...args) {\n    const set = this.#listeners.get(event);\n    if (set) {\n      for (const fn of set) fn(...args);\n    }\n    // Wildcard listeners\n    const wildcard = this.#listeners.get('*');\n    if (wildcard) {\n      for (const fn of wildcard) fn(event, ...args);\n    }\n  }\n\n  /** Remove all listeners, optionally for a specific event. */\n  removeAllListeners(event) {\n    if (event) {\n      this.#listeners.delete(event);\n    } else {\n      this.#listeners.clear();\n    }\n  }\n\n  /** Number of listeners for an event. */\n  listenerCount(event) {\n    return this.#listeners.get(event)?.size ?? 0;\n  }\n}\n","/**\n * Audio format conversion and DSP utility functions.\n * @module audio-utils\n */\n\n/**\n * Convert Int16 PCM samples to Float32 [-1, 1].\n * @param {Int16Array} int16 - Input PCM samples.\n * @returns {Float32Array}\n */\nexport function int16ToFloat32(int16) {\n  const float32 = new Float32Array(int16.length);\n  for (let i = 0; i < int16.length; i++) {\n    float32[i] = int16[i] / 32768.0;\n  }\n  return float32;\n}\n\n/**\n * Convert Float32 [-1, 1] samples to Int16 PCM.\n * @param {Float32Array} float32 - Input samples.\n * @returns {Int16Array}\n */\nexport function float32ToInt16(float32) {\n  const int16 = new Int16Array(float32.length);\n  for (let i = 0; i < float32.length; i++) {\n    const s = Math.max(-1, Math.min(1, float32[i]));\n    int16[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;\n  }\n  return int16;\n}\n\n/**\n * Decode a base64-encoded PCM16 chunk to Int16Array.\n * Common when receiving audio from WebSocket APIs (OpenAI Realtime, ElevenLabs).\n * @param {string} base64 - Base64-encoded PCM16 audio.\n * @returns {Int16Array}\n */\nexport function base64ToInt16(base64) {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return new Int16Array(bytes.buffer);\n}\n\n/**\n * Encode Int16Array to base64 string.\n * @param {Int16Array} int16\n * @returns {string}\n */\nexport function int16ToBase64(int16) {\n  const bytes = new Uint8Array(int16.buffer);\n  let binary = '';\n  for (let i = 0; i < bytes.length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}\n\n/**\n * Calculate RMS (Root Mean Square) amplitude of a signal.\n * @param {Float32Array|Uint8Array} data - Audio samples.\n * @param {boolean} [isByte=false] - If true, treats data as unsigned byte (0-255) from AnalyserNode.\n * @returns {number} RMS value [0, 1].\n */\nexport function calculateRMS(data, isByte = false) {\n  let sumSquares = 0;\n  const len = data.length;\n  if (len === 0) return 0;\n\n  for (let i = 0; i < len; i++) {\n    const value = isByte ? (data[i] - 128) / 128 : data[i];\n    sumSquares += value * value;\n  }\n  return Math.sqrt(sumSquares / len);\n}\n\n/**\n * Calculate zero-crossing rate (indicator of noisiness / fricatives).\n * @param {Float32Array} data\n * @returns {number} Crossings per sample (0..1).\n */\nexport function zeroCrossingRate(data) {\n  if (data.length < 2) return 0;\n  let crossings = 0;\n  for (let i = 1; i < data.length; i++) {\n    if ((data[i] >= 0 && data[i - 1] < 0) || (data[i] < 0 && data[i - 1] >= 0)) {\n      crossings++;\n    }\n  }\n  return crossings / (data.length - 1);\n}\n\n/**\n * Extract frequency band energies from FFT data.\n * @param {Uint8Array} frequencyData - From AnalyserNode.getByteFrequencyData().\n * @param {number} sampleRate - Audio context sample rate.\n * @param {Array<{name: string, min: number, max: number}>} [bands] - Custom frequency bands.\n * @returns {Object<string, number>} Band energies normalized 0..1.\n */\nexport function extractBandEnergies(frequencyData, sampleRate, bands) {\n  const defaultBands = bands || [\n    { name: 'sub',      min: 20,   max: 200  },  // Fundamental freq, voiced sounds\n    { name: 'low',      min: 200,  max: 800  },  // First formant region\n    { name: 'mid',      min: 800,  max: 2500 },  // Second formant region\n    { name: 'high',     min: 2500, max: 5500 },  // Fricatives, sibilants\n    { name: 'veryHigh', min: 5500, max: 12000 }, // Plosive bursts, high sibilants\n  ];\n\n  const binCount = frequencyData.length;\n  const nyquist = sampleRate / 2;\n  const binWidth = nyquist / binCount;\n  const result = {};\n\n  for (const band of defaultBands) {\n    const startBin = Math.max(0, Math.floor(band.min / binWidth));\n    const endBin = Math.min(binCount - 1, Math.floor(band.max / binWidth));\n    \n    if (startBin >= endBin) {\n      result[band.name] = 0;\n      continue;\n    }\n\n    let sum = 0;\n    let count = 0;\n    for (let i = startBin; i <= endBin; i++) {\n      sum += frequencyData[i] / 255;\n      count++;\n    }\n    result[band.name] = count > 0 ? sum / count : 0;\n  }\n\n  return result;\n}\n\n/**\n * Smooth a value toward a target using exponential moving average.\n * @param {number} current - Current smoothed value.\n * @param {number} target - Target raw value.\n * @param {number} factor - Smoothing factor (0 = no smoothing, 1 = no change).\n * @returns {number}\n */\nexport function smoothValue(current, target, factor) {\n  return current + (target - current) * (1 - factor);\n}\n\n/**\n * Linear interpolation between two values.\n * @param {number} a\n * @param {number} b\n * @param {number} t - Interpolation factor [0, 1].\n * @returns {number}\n */\nexport function lerp(a, b, t) {\n  return a + (b - a) * Math.max(0, Math.min(1, t));\n}\n\n/**\n * Clamp a value between min and max.\n * @param {number} value\n * @param {number} min\n * @param {number} max\n * @returns {number}\n */\nexport function clamp(value, min, max) {\n  return Math.max(min, Math.min(max, value));\n}\n\n/**\n * Resample Float32 audio from one sample rate to another (linear interpolation).\n * @param {Float32Array} input\n * @param {number} fromRate\n * @param {number} toRate\n * @returns {Float32Array}\n */\nexport function resample(input, fromRate, toRate) {\n  if (fromRate === toRate) return input;\n  const ratio = fromRate / toRate;\n  const outputLength = Math.round(input.length / ratio);\n  const output = new Float32Array(outputLength);\n  for (let i = 0; i < outputLength; i++) {\n    const srcIndex = i * ratio;\n    const low = Math.floor(srcIndex);\n    const high = Math.min(low + 1, input.length - 1);\n    const frac = srcIndex - low;\n    output[i] = input[low] * (1 - frac) + input[high] * frac;\n  }\n  return output;\n}\n","/**\n * Viseme definitions, mappings, and phoneme data.\n *\n * Supports two standard sets:\n *   - EXTENDED (15 shapes) — Oculus/MPEG-4 standard\n *   - SIMPLE   (6 shapes)  — Preston Blair / Hanna-Barbera\n *\n * @module visemes\n */\n\n// ─── Extended 15-shape set (Oculus OVRLipSync compatible) ────────────────────\n\nexport const EXTENDED_VISEMES = /** @type {const} */ ({\n  sil: { label: 'Silent',     description: 'Mouth closed, neutral' },\n  PP:  { label: 'P/B/M',      description: 'Lips pressed together' },\n  FF:  { label: 'F/V',        description: 'Lower lip to upper teeth' },\n  TH:  { label: 'TH',         description: 'Tongue between teeth' },\n  DD:  { label: 'D/T/N/L',    description: 'Tongue to upper palate' },\n  kk:  { label: 'K/G',        description: 'Back of tongue raised' },\n  CH:  { label: 'CH/SH/J',    description: 'Lips pursed forward' },\n  SS:  { label: 'S/Z',        description: 'Teeth close, slight smile' },\n  nn:  { label: 'N/NG',       description: 'Mouth slightly open, nasal' },\n  RR:  { label: 'R',          description: 'Lips slightly rounded' },\n  aa:  { label: 'AA/AH',      description: 'Wide open mouth' },\n  E:   { label: 'EH/AE',      description: 'Mouth open, slight smile' },\n  I:   { label: 'IH/IY',      description: 'Small opening, smile' },\n  O:   { label: 'OH/AO',      description: 'Rounded, medium open' },\n  U:   { label: 'UW/OW',      description: 'Small rounded opening' },\n});\n\n/** @type {string[]} Ordered list of extended viseme keys. */\nexport const EXTENDED_VISEME_KEYS = Object.keys(EXTENDED_VISEMES);\n\n// ─── Simple 6-shape set (Preston Blair / Hanna-Barbera) ─────────────────────\n\nexport const SIMPLE_VISEMES = /** @type {const} */ ({\n  A: { label: 'Rest / M/B/P closed',  extendedMap: ['sil'] },\n  B: { label: 'M / B / P',            extendedMap: ['PP', 'nn'] },\n  C: { label: 'EE / S / soft sounds',  extendedMap: ['E', 'I', 'SS'] },\n  D: { label: 'AH / wide open',       extendedMap: ['aa', 'DD', 'kk'] },\n  E: { label: 'OH / round',           extendedMap: ['O', 'RR', 'CH'] },\n  F: { label: 'OO / F / V / tight',   extendedMap: ['FF', 'TH', 'U'] },\n});\n\n/** @type {string[]} Ordered list of simple viseme keys. */\nexport const SIMPLE_VISEME_KEYS = Object.keys(SIMPLE_VISEMES);\n\n// ─── Extended → Simple mapping ──────────────────────────────────────────────\n\n/** @type {Object<string, string>} */\nexport const EXTENDED_TO_SIMPLE = {};\nfor (const [simpleKey, def] of Object.entries(SIMPLE_VISEMES)) {\n  for (const ext of def.extendedMap) {\n    EXTENDED_TO_SIMPLE[ext] = simpleKey;\n  }\n}\n\n// ─── CMU/ARPABET Phoneme → Extended Viseme ──────────────────────────────────\n\nexport const PHONEME_TO_VISEME = /** @type {const} */ ({\n  // Vowels\n  AA: 'aa', AE: 'E',  AH: 'aa', AO: 'O',  AW: 'aa',\n  AY: 'aa', EH: 'E',  ER: 'RR', EY: 'E',  IH: 'I',\n  IY: 'I',  OW: 'O',  OY: 'O',  UH: 'U',  UW: 'U',\n  // Consonants\n  B:  'PP', CH: 'CH', D:  'DD', DH: 'TH', F:  'FF',\n  G:  'kk', HH: 'aa', JH: 'CH', K:  'kk', L:  'DD',\n  M:  'PP', N:  'nn', NG: 'nn', P:  'PP', R:  'RR',\n  S:  'SS', SH: 'CH', T:  'DD', TH: 'TH', V:  'FF',\n  W:  'U',  Y:  'I',  Z:  'SS', ZH: 'CH',\n});\n\n/** @type {string[]} All known ARPABET phonemes. */\nexport const ARPABET_PHONEMES = Object.keys(PHONEME_TO_VISEME);\n\n// ─── Viseme transition weights (coarticulation hints) ───────────────────────\n// Higher weight = slower transition (more blending needed)\n\n/** @type {Object<string, Object<string, number>>} */\nexport const TRANSITION_WEIGHTS = {\n  sil: { aa: 0.3, E: 0.3, I: 0.3, O: 0.3, U: 0.3, PP: 0.2, FF: 0.2 },\n  aa:  { sil: 0.4, E: 0.5, O: 0.6, I: 0.5, PP: 0.3, SS: 0.3 },\n  PP:  { aa: 0.2, sil: 0.2, E: 0.3, FF: 0.4 },\n  FF:  { aa: 0.3, PP: 0.4, sil: 0.2 },\n  SS:  { sil: 0.2, aa: 0.3, CH: 0.6 },\n};\n\n/**\n * Get the transition weight between two visemes.\n * @param {string} from\n * @param {string} to\n * @returns {number} Weight 0..1 (higher = more blending).\n */\nexport function getTransitionWeight(from, to) {\n  return TRANSITION_WEIGHTS[from]?.[to] ?? 0.35; // sensible default\n}\n\n// ─── Mouth shape parameters for procedural rendering ────────────────────────\n// Each viseme maps to normalized parameters: openness, width, roundness\n\n/** @type {Object<string, {open: number, width: number, round: number}>} */\nexport const VISEME_SHAPES = {\n  sil: { open: 0.00, width: 0.50, round: 0.0 },\n  PP:  { open: 0.00, width: 0.40, round: 0.0 },\n  FF:  { open: 0.05, width: 0.55, round: 0.0 },\n  TH:  { open: 0.10, width: 0.50, round: 0.0 },\n  DD:  { open: 0.20, width: 0.50, round: 0.0 },\n  kk:  { open: 0.25, width: 0.45, round: 0.0 },\n  CH:  { open: 0.15, width: 0.35, round: 0.6 },\n  SS:  { open: 0.05, width: 0.60, round: 0.0 },\n  nn:  { open: 0.15, width: 0.50, round: 0.0 },\n  RR:  { open: 0.20, width: 0.40, round: 0.4 },\n  aa:  { open: 0.90, width: 0.60, round: 0.0 },\n  E:   { open: 0.50, width: 0.65, round: 0.0 },\n  I:   { open: 0.25, width: 0.70, round: 0.0 },\n  O:   { open: 0.60, width: 0.40, round: 0.8 },\n  U:   { open: 0.20, width: 0.30, round: 0.9 },\n};\n\n/**\n * Get interpolated mouth shape between two visemes.\n * @param {string} fromViseme\n * @param {string} toViseme\n * @param {number} t - Interpolation factor [0, 1].\n * @returns {{open: number, width: number, round: number}}\n */\nexport function interpolateShapes(fromViseme, toViseme, t) {\n  const a = VISEME_SHAPES[fromViseme] || VISEME_SHAPES.sil;\n  const b = VISEME_SHAPES[toViseme] || VISEME_SHAPES.sil;\n  const clampT = Math.max(0, Math.min(1, t));\n  return {\n    open:  a.open  + (b.open  - a.open)  * clampT,\n    width: a.width + (b.width - a.width) * clampT,\n    round: a.round + (b.round - a.round) * clampT,\n  };\n}\n","/**\n * FrequencyAnalyzer — Real-time viseme detection from audio frequency analysis.\n *\n * Uses AnalyserNode FFT data to classify audio frames into viseme categories\n * based on frequency band energy distribution, amplitude, and zero-crossing rate.\n *\n * Detection pipeline:\n *   1. Silence gate → sil\n *   2. Band energy extraction (5 bands)\n *   3. Feature classification (sibilant, fricative, vowel, plosive, nasal)\n *   4. Viseme selection with confidence scoring\n *   5. Temporal smoothing (EMA + holdoff)\n *\n * @module FrequencyAnalyzer\n */\n\nimport {\n  calculateRMS,\n  extractBandEnergies,\n  smoothValue,\n  clamp,\n} from '../utils/audio-utils.js';\nimport {\n  EXTENDED_TO_SIMPLE,\n  VISEME_SHAPES,\n  getTransitionWeight,\n} from '../core/visemes.js';\n\n/** Default analyzer configuration. */\nconst DEFAULTS = {\n  fftSize: 256,\n  silenceThreshold: 0.015,\n  smoothingFactor: 0.35,\n  holdFrames: 2,           // Minimum frames to hold a viseme before switching\n  intensitySmoothing: 0.2,\n  energySmoothing: 0.5,    // AnalyserNode smoothingTimeConstant\n};\n\nexport class FrequencyAnalyzer {\n  /**\n   * @param {AnalyserNode} analyserNode - Connected AnalyserNode.\n   * @param {number} sampleRate - AudioContext sample rate.\n   * @param {Object} [options]\n   */\n  constructor(analyserNode, sampleRate, options = {}) {\n    this.analyser = analyserNode;\n    this.sampleRate = sampleRate;\n    this.opts = { ...DEFAULTS, ...options };\n\n    // Configure analyser\n    this.analyser.fftSize = this.opts.fftSize;\n    this.analyser.smoothingTimeConstant = this.opts.energySmoothing;\n\n    // Analysis buffers\n    this.timeDomainData = new Uint8Array(this.analyser.fftSize);\n    this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount);\n\n    // State\n    this._currentViseme = 'sil';\n    this._currentIntensity = 0;\n    this._holdCounter = 0;\n    this._smoothedAmplitude = 0;\n    this._smoothedBands = { sub: 0, low: 0, mid: 0, high: 0, veryHigh: 0 };\n    this._previousViseme = 'sil';\n    this._transitionProgress = 1; // 0..1 blend between prev → current\n    this._frameCount = 0;\n  }\n\n  /**\n   * Analyze the current audio frame and return viseme data.\n   * Call this once per animation frame (~60fps) or at your desired analysis rate.\n   *\n   * @returns {VisemeFrame}\n   */\n  analyze() {\n    this._frameCount++;\n\n    // ── Gather raw data ──────────────────────────────────────────\n    this.analyser.getByteTimeDomainData(this.timeDomainData);\n    this.analyser.getByteFrequencyData(this.frequencyData);\n\n    const rawAmplitude = calculateRMS(this.timeDomainData, true);\n    this._smoothedAmplitude = smoothValue(\n      this._smoothedAmplitude,\n      rawAmplitude,\n      this.opts.smoothingFactor\n    );\n\n    // ── Band energies ────────────────────────────────────────────\n    const rawBands = extractBandEnergies(this.frequencyData, this.sampleRate);\n    for (const key of Object.keys(rawBands)) {\n      this._smoothedBands[key] = smoothValue(\n        this._smoothedBands[key] || 0,\n        rawBands[key],\n        this.opts.smoothingFactor\n      );\n    }\n    const bands = this._smoothedBands;\n\n    // ── Silence gate ─────────────────────────────────────────────\n    if (this._smoothedAmplitude < this.opts.silenceThreshold) {\n      return this._emitViseme('sil', 0, bands);\n    }\n\n    // ── Feature extraction ───────────────────────────────────────\n    const intensity = clamp(this._smoothedAmplitude * 3, 0, 1);\n    const { viseme, confidence } = this._classifyViseme(bands, intensity);\n\n    // ── Hold-off: prevent rapid flickering ───────────────────────\n    if (viseme !== this._currentViseme) {\n      this._holdCounter++;\n      if (this._holdCounter < this.opts.holdFrames) {\n        // Keep current viseme during hold period\n        return this._emitViseme(this._currentViseme, intensity, bands);\n      }\n      this._holdCounter = 0;\n    } else {\n      this._holdCounter = 0;\n    }\n\n    return this._emitViseme(viseme, intensity, bands, confidence);\n  }\n\n  /**\n   * Classify the current audio frame into a viseme.\n   * @private\n   */\n  _classifyViseme(bands, intensity) {\n    const { sub, low, mid, high, veryHigh } = bands;\n    const totalEnergy = sub + low + mid + high + veryHigh;\n\n    if (totalEnergy < 0.01) {\n      return { viseme: 'sil', confidence: 0.9 };\n    }\n\n    // ── Sibilants (S, Z, SH) → heavy high-frequency ─────────────\n    const sibilantScore = (high + veryHigh) / (totalEnergy + 0.001);\n    if (sibilantScore > 0.55 && high > 0.15) {\n      if (veryHigh > high * 0.8) {\n        return { viseme: 'SS', confidence: sibilantScore };\n      }\n      return { viseme: 'CH', confidence: sibilantScore * 0.85 };\n    }\n\n    // ── Fricatives (F, V, TH) → mid-high energy ─────────────────\n    const fricativeScore = (mid + high) / (totalEnergy + 0.001);\n    if (fricativeScore > 0.5 && high > 0.1 && low < 0.15) {\n      return { viseme: 'FF', confidence: fricativeScore * 0.8 };\n    }\n\n    // ── Plosives (P, B, T, D) → sudden energy burst ─────────────\n    // Detected by high intensity with relatively flat spectrum\n    const flatness = 1 - Math.abs(high - low) / (totalEnergy + 0.001);\n    if (intensity > 0.6 && flatness > 0.7 && this._smoothedAmplitude > 0.08) {\n      if (low > mid) {\n        return { viseme: 'PP', confidence: 0.6 };\n      }\n      return { viseme: 'DD', confidence: 0.6 };\n    }\n\n    // ── Nasals (M, N, NG) → strong sub/low, weak mid/high ───────\n    if (sub > 0.2 && low > 0.15 && high < 0.08 && mid < low * 0.7) {\n      return { viseme: 'nn', confidence: 0.65 };\n    }\n\n    // ── Vowels — classified by formant-like band patterns ────────\n    // This is approximate; real formant tracking needs higher FFT resolution\n\n    // Wide open (AA/AH): strong low+mid, moderate sub\n    if (low > 0.2 && mid > 0.15 && intensity > 0.5) {\n      return { viseme: 'aa', confidence: 0.7 };\n    }\n\n    // EH/AE: mid stronger than low\n    if (mid > low && mid > 0.15 && intensity > 0.3) {\n      return { viseme: 'E', confidence: 0.65 };\n    }\n\n    // OH/AO: sub+low dominant, some mid\n    if (sub > mid && low > mid && intensity > 0.3) {\n      return { viseme: 'O', confidence: 0.6 };\n    }\n\n    // IH/IY: higher-mid energy, narrower mouth\n    if (mid > 0.1 && high > low * 0.5 && intensity > 0.2) {\n      return { viseme: 'I', confidence: 0.55 };\n    }\n\n    // UW/OW: strong sub, weak everything else\n    if (sub > 0.15 && high < 0.05) {\n      return { viseme: 'U', confidence: 0.5 };\n    }\n\n    // ── Default: amplitude-based fallback ────────────────────────\n    if (intensity > 0.5) return { viseme: 'aa', confidence: 0.4 };\n    if (intensity > 0.3) return { viseme: 'E', confidence: 0.35 };\n    if (intensity > 0.15) return { viseme: 'I', confidence: 0.3 };\n    return { viseme: 'sil', confidence: 0.5 };\n  }\n\n  /**\n   * Build and return the viseme frame, updating transitions.\n   * @private\n   */\n  _emitViseme(viseme, intensity, bands, confidence = 0.5) {\n    // Track transitions\n    if (viseme !== this._currentViseme) {\n      this._previousViseme = this._currentViseme;\n      this._currentViseme = viseme;\n      this._transitionProgress = 0;\n    } else {\n      // Advance transition\n      const weight = getTransitionWeight(this._previousViseme, this._currentViseme);\n      this._transitionProgress = Math.min(1, this._transitionProgress + (1 - weight) * 0.3);\n    }\n\n    // Smooth intensity\n    this._currentIntensity = smoothValue(\n      this._currentIntensity,\n      intensity,\n      this.opts.intensitySmoothing\n    );\n\n    // Get mouth shape parameters (interpolated during transition)\n    const prevShape = VISEME_SHAPES[this._previousViseme] || VISEME_SHAPES.sil;\n    const currShape = VISEME_SHAPES[this._currentViseme] || VISEME_SHAPES.sil;\n    const t = this._transitionProgress;\n\n    return {\n      viseme: this._currentViseme,\n      simpleViseme: EXTENDED_TO_SIMPLE[this._currentViseme] || 'A',\n      intensity: this._currentIntensity,\n      confidence,\n      amplitude: this._smoothedAmplitude,\n      bands: { ...this._smoothedBands },\n      shape: {\n        open:  prevShape.open  + (currShape.open  - prevShape.open)  * t,\n        width: prevShape.width + (currShape.width - prevShape.width) * t,\n        round: prevShape.round + (currShape.round - prevShape.round) * t,\n      },\n      transition: {\n        from: this._previousViseme,\n        to: this._currentViseme,\n        progress: this._transitionProgress,\n      },\n      frame: this._frameCount,\n    };\n  }\n\n  /** Reset analyzer state. */\n  reset() {\n    this._currentViseme = 'sil';\n    this._currentIntensity = 0;\n    this._holdCounter = 0;\n    this._smoothedAmplitude = 0;\n    this._smoothedBands = { sub: 0, low: 0, mid: 0, high: 0, veryHigh: 0 };\n    this._previousViseme = 'sil';\n    this._transitionProgress = 1;\n    this._frameCount = 0;\n  }\n}\n\n/**\n * @typedef {Object} VisemeFrame\n * @property {string} viseme - Extended viseme key.\n * @property {string} simpleViseme - Simple (A-F) viseme key.\n * @property {number} intensity - Smoothed speech intensity [0, 1].\n * @property {number} confidence - Classification confidence [0, 1].\n * @property {number} amplitude - Smoothed RMS amplitude [0, 1].\n * @property {Object} bands - Frequency band energies.\n * @property {Object} shape - Interpolated mouth shape {open, width, round}.\n * @property {Object} transition - Transition state {from, to, progress}.\n * @property {number} frame - Analysis frame counter.\n */\n","/**\n * LipSyncEngine — Main orchestrator for streaming lip-sync.\n *\n * Manages the full audio pipeline:\n *   AudioSource → AudioWorklet → AnalyserNode → FrequencyAnalyzer → Events\n *\n * Supports three input modes:\n *   1. Streaming PCM chunks (from TTS APIs like OpenAI Realtime, ElevenLabs)\n *   2. MediaStream (microphone, WebRTC)\n *   3. HTMLMediaElement (audio/video element)\n *\n * @module LipSyncEngine\n *\n * @example\n *   import { LipSyncEngine } from '@beer-digital/lipsync-engine';\n *\n *   const engine = new LipSyncEngine({ sampleRate: 24000 });\n *   await engine.init();\n *\n *   engine.on('viseme', (frame) => {\n *     updateAvatar(frame.viseme, frame.intensity, frame.shape);\n *   });\n *\n *   // Feed PCM chunks from TTS\n *   ws.onmessage = (e) => {\n *     const data = JSON.parse(e.data);\n *     if (data.type === 'audio') {\n *       engine.feedAudio(base64ToInt16(data.audio));\n *     }\n *   };\n */\n\nimport { EventEmitter } from '../utils/EventEmitter.js';\nimport { FrequencyAnalyzer } from '../analyzers/FrequencyAnalyzer.js';\nimport { int16ToFloat32, resample } from '../utils/audio-utils.js';\n\n/** @type {Object} Default engine options. */\nconst DEFAULTS = {\n  // Audio pipeline\n  sampleRate: 24000,           // Expected input sample rate\n  fftSize: 256,                // FFT window size (power of 2)\n  analyserSmoothing: 0.5,      // AnalyserNode smoothingTimeConstant\n\n  // Viseme detection\n  silenceThreshold: 0.015,     // RMS below this = silence\n  smoothingFactor: 0.35,       // Viseme transition smoothing (0-1)\n  holdFrames: 2,               // Min frames before viseme switch\n  intensitySmoothing: 0.2,     // Intensity EMA factor\n\n  // Playback\n  volume: 1.0,\n  startThresholdMs: 50,        // Buffer ms before auto-play\n  bufferSeconds: 5,            // Ring buffer capacity\n\n  // Analysis timing\n  analysisMode: 'raf',         // 'raf' (requestAnimationFrame) or 'interval'\n  analysisIntervalMs: 16,      // Only used when analysisMode = 'interval'\n\n  // Worklet\n  workletUrl: null,            // Custom worklet URL (auto-detected if null)\n  disablePlayback: false,      // If true, analyze only (no audio output)\n};\n\nexport class LipSyncEngine extends EventEmitter {\n  /**\n   * @param {Partial<typeof DEFAULTS>} options\n   */\n  constructor(options = {}) {\n    super();\n    this.opts = { ...DEFAULTS, ...options };\n\n    /** @type {AudioContext|null} */\n    this.audioContext = null;\n\n    /** @type {AudioWorkletNode|null} */\n    this.workletNode = null;\n\n    /** @type {AnalyserNode|null} */\n    this.analyserNode = null;\n\n    /** @type {GainNode|null} */\n    this.gainNode = null;\n\n    /** @type {FrequencyAnalyzer|null} */\n    this.analyzer = null;\n\n    /** @type {MediaStreamAudioSourceNode|null} */\n    this._mediaSource = null;\n\n    /** @type {MediaElementAudioSourceNode|null} */\n    this._elementSource = null;\n\n    // State\n    this._initialized = false;\n    this._analyzing = false;\n    this._animFrameId = null;\n    this._intervalId = null;\n    this._inputMode = null; // 'stream' | 'media' | 'element'\n    this._playbackTimeMs = 0;\n    this._bufferLevel = 0;\n    this._destroyed = false;\n  }\n\n  // ════════════════════════════════════════════════════════════════\n  //  INITIALIZATION\n  // ════════════════════════════════════════════════════════════════\n\n  /**\n   * Initialize the audio pipeline. Must be called after a user gesture (browser policy).\n   * @param {AudioContext} [existingContext] - Optionally reuse an existing AudioContext.\n   * @returns {Promise<void>}\n   */\n  async init(existingContext) {\n    if (this._initialized) return;\n    if (this._destroyed) throw new Error('Engine has been destroyed');\n\n    // Create or reuse AudioContext\n    this.audioContext = existingContext || new AudioContext({\n      sampleRate: this.opts.sampleRate,\n    });\n\n    // Resume if suspended (browser autoplay policy)\n    if (this.audioContext.state === 'suspended') {\n      await this.audioContext.resume();\n    }\n\n    // Load AudioWorklet\n    const workletUrl = this.opts.workletUrl || this._resolveWorkletUrl();\n    await this.audioContext.audioWorklet.addModule(workletUrl);\n\n    // Create worklet node\n    this.workletNode = new AudioWorkletNode(\n      this.audioContext,\n      'streaming-processor',\n      {\n        processorOptions: {\n          sampleRate: this.opts.sampleRate,\n          bufferSeconds: this.opts.bufferSeconds,\n          startThresholdMs: this.opts.startThresholdMs,\n        },\n      }\n    );\n\n    // Create analyser\n    this.analyserNode = this.audioContext.createAnalyser();\n    this.analyserNode.fftSize = this.opts.fftSize;\n    this.analyserNode.smoothingTimeConstant = this.opts.analyserSmoothing;\n\n    // Create gain node\n    this.gainNode = this.audioContext.createGain();\n    this.gainNode.gain.value = this.opts.volume;\n\n    // Connect pipeline: Worklet → Analyser → Gain → Destination\n    this.workletNode.connect(this.analyserNode);\n    if (!this.opts.disablePlayback) {\n      this.analyserNode.connect(this.gainNode);\n      this.gainNode.connect(this.audioContext.destination);\n    }\n\n    // Create frequency analyzer\n    this.analyzer = new FrequencyAnalyzer(\n      this.analyserNode,\n      this.audioContext.sampleRate,\n      {\n        fftSize: this.opts.fftSize,\n        silenceThreshold: this.opts.silenceThreshold,\n        smoothingFactor: this.opts.smoothingFactor,\n        holdFrames: this.opts.holdFrames,\n        intensitySmoothing: this.opts.intensitySmoothing,\n      }\n    );\n\n    // Listen for worklet messages\n    this.workletNode.port.onmessage = (e) => this._onWorkletMessage(e.data);\n\n    this._initialized = true;\n    this._inputMode = 'stream';\n    this.emit('initialized');\n  }\n\n  /**\n   * Try to resolve the worklet URL automatically.\n   * @private\n   */\n  _resolveWorkletUrl() {\n    // Try common locations\n    const candidates = [\n      './streaming-processor.js',\n      './worklet/streaming-processor.js',\n      './dist/worklet/streaming-processor.js',\n      '/streaming-processor.js',\n    ];\n\n    // If running from npm package, try node_modules path\n    // The consumer should ideally provide workletUrl explicitly\n    return candidates[0];\n  }\n\n  // ════════════════════════════════════════════════════════════════\n  //  INPUT SOURCES\n  // ════════════════════════════════════════════════════════════════\n\n  /**\n   * Feed PCM audio chunks for streaming playback + analysis.\n   * This is the primary method for TTS API integration.\n   *\n   * @param {Int16Array|Float32Array|ArrayBuffer} samples - Audio samples.\n   * @param {number} [inputSampleRate] - Override sample rate for this chunk.\n   */\n  feedAudio(samples, inputSampleRate) {\n    this._ensureInitialized();\n\n    let float32;\n\n    if (samples instanceof Int16Array) {\n      float32 = int16ToFloat32(samples);\n    } else if (samples instanceof Float32Array) {\n      float32 = samples;\n    } else if (samples instanceof ArrayBuffer) {\n      // Assume Int16 PCM\n      float32 = int16ToFloat32(new Int16Array(samples));\n    } else if (ArrayBuffer.isView(samples)) {\n      float32 = int16ToFloat32(new Int16Array(samples.buffer));\n    } else {\n      throw new TypeError('feedAudio expects Int16Array, Float32Array, or ArrayBuffer');\n    }\n\n    // Resample if needed\n    const srcRate = inputSampleRate || this.opts.sampleRate;\n    if (srcRate !== this.audioContext.sampleRate) {\n      float32 = resample(float32, srcRate, this.audioContext.sampleRate);\n    }\n\n    // Send to worklet\n    this.workletNode.port.postMessage(\n      { type: 'audio', samples: float32 },\n      [float32.buffer] // Transfer ownership for zero-copy\n    );\n  }\n\n  /**\n   * Attach a MediaStream (e.g., microphone) for analysis.\n   * Audio is analyzed but NOT played back (to avoid feedback).\n   *\n   * @param {MediaStream} stream\n   */\n  attachStream(stream) {\n    this._ensureInitialized();\n    this._disconnectSources();\n\n    this._mediaSource = this.audioContext.createMediaStreamSource(stream);\n    this._mediaSource.connect(this.analyserNode);\n    // Don't connect to destination (feedback prevention)\n\n    this._inputMode = 'media';\n    this.emit('sourceAttached', { type: 'stream' });\n  }\n\n  /**\n   * Attach an HTML audio/video element for analysis.\n   *\n   * @param {HTMLMediaElement} element\n   */\n  attachElement(element) {\n    this._ensureInitialized();\n    this._disconnectSources();\n\n    this._elementSource = this.audioContext.createMediaElementSource(element);\n    this._elementSource.connect(this.analyserNode);\n    this.analyserNode.connect(this.audioContext.destination);\n\n    this._inputMode = 'element';\n    this.emit('sourceAttached', { type: 'element' });\n  }\n\n  /**\n   * Disconnect any attached media sources.\n   * @private\n   */\n  _disconnectSources() {\n    if (this._mediaSource) {\n      try { this._mediaSource.disconnect(); } catch {}\n      this._mediaSource = null;\n    }\n    if (this._elementSource) {\n      try { this._elementSource.disconnect(); } catch {}\n      this._elementSource = null;\n    }\n  }\n\n  // ════════════════════════════════════════════════════════════════\n  //  ANALYSIS LOOP\n  // ════════════════════════════════════════════════════════════════\n\n  /**\n   * Start the viseme analysis loop.\n   * Emits 'viseme' events at the configured rate.\n   */\n  startAnalysis() {\n    if (this._analyzing) return;\n    this._ensureInitialized();\n    this._analyzing = true;\n\n    if (this.opts.analysisMode === 'raf') {\n      this._startRAFLoop();\n    } else {\n      this._startIntervalLoop();\n    }\n\n    this.emit('analysisStarted');\n  }\n\n  /** Stop the viseme analysis loop. */\n  stopAnalysis() {\n    this._analyzing = false;\n\n    if (this._animFrameId !== null) {\n      cancelAnimationFrame(this._animFrameId);\n      this._animFrameId = null;\n    }\n    if (this._intervalId !== null) {\n      clearInterval(this._intervalId);\n      this._intervalId = null;\n    }\n\n    this.emit('analysisStopped');\n  }\n\n  /** @private */\n  _startRAFLoop() {\n    const tick = () => {\n      if (!this._analyzing) return;\n      this._analyzeFrame();\n      this._animFrameId = requestAnimationFrame(tick);\n    };\n    this._animFrameId = requestAnimationFrame(tick);\n  }\n\n  /** @private */\n  _startIntervalLoop() {\n    this._intervalId = setInterval(() => {\n      if (!this._analyzing) return;\n      this._analyzeFrame();\n    }, this.opts.analysisIntervalMs);\n  }\n\n  /** @private */\n  _analyzeFrame() {\n    const frame = this.analyzer.analyze();\n    frame.timeMs = this._playbackTimeMs;\n    frame.bufferLevel = this._bufferLevel;\n    this.emit('viseme', frame);\n  }\n\n  // ════════════════════════════════════════════════════════════════\n  //  WORKLET COMMUNICATION\n  // ════════════════════════════════════════════════════════════════\n\n  /** @private */\n  _onWorkletMessage(data) {\n    switch (data.type) {\n      case 'position':\n        this._playbackTimeMs = data.timeMs;\n        this._bufferLevel = data.bufferLevel;\n        this.emit('position', {\n          timeMs: data.timeMs,\n          bufferLevel: data.bufferLevel,\n          bufferMs: data.bufferMs,\n          isPlaying: data.isPlaying,\n        });\n        break;\n\n      case 'playbackStarted':\n        this.emit('playbackStarted');\n        break;\n\n      case 'playbackEnded':\n        this.emit('playbackEnded');\n        break;\n\n      case 'bufferUnderrun':\n        this.emit('bufferUnderrun', { timeMs: data.timeMs });\n        break;\n\n      case 'bufferOverflow':\n        this.emit('bufferOverflow', { dropped: data.dropped });\n        break;\n\n      case 'ready':\n        this.emit('workletReady');\n        break;\n    }\n  }\n\n  // ════════════════════════════════════════════════════════════════\n  //  CONTROLS\n  // ════════════════════════════════════════════════════════════════\n\n  /**\n   * Set playback volume.\n   * @param {number} value - Volume [0, 1].\n   */\n  setVolume(value) {\n    const v = Math.max(0, Math.min(1, value));\n    if (this.gainNode) {\n      this.gainNode.gain.setTargetAtTime(v, this.audioContext.currentTime, 0.02);\n    }\n    this.workletNode?.port.postMessage({ type: 'setVolume', value: v });\n  }\n\n  /** Clear the audio buffer (stops playback of buffered audio). */\n  clearBuffer() {\n    this.workletNode?.port.postMessage({ type: 'clear' });\n  }\n\n  /** Start playback (if paused). */\n  play() {\n    this.workletNode?.port.postMessage({ type: 'start' });\n  }\n\n  /** Pause playback. */\n  pause() {\n    this.workletNode?.port.postMessage({ type: 'stop' });\n  }\n\n  /** Reset all state (buffer, position, analyzer). */\n  reset() {\n    this.workletNode?.port.postMessage({ type: 'reset' });\n    this.analyzer?.reset();\n    this._playbackTimeMs = 0;\n    this._bufferLevel = 0;\n    this.emit('reset');\n  }\n\n  // ════════════════════════════════════════════════════════════════\n  //  STATE QUERIES\n  // ════════════════════════════════════════════════════════════════\n\n  /** Whether the engine has been initialized. */\n  get initialized() { return this._initialized; }\n\n  /** Whether analysis is currently running. */\n  get analyzing() { return this._analyzing; }\n\n  /** Current playback position in milliseconds. */\n  get playbackTimeMs() { return this._playbackTimeMs; }\n\n  /** Current buffer fill level (0..1). */\n  get bufferLevel() { return this._bufferLevel; }\n\n  /** Current input mode: 'stream', 'media', or 'element'. */\n  get inputMode() { return this._inputMode; }\n\n  /**\n   * Get a snapshot of current engine state.\n   * @returns {Object}\n   */\n  getState() {\n    return {\n      initialized: this._initialized,\n      analyzing: this._analyzing,\n      inputMode: this._inputMode,\n      playbackTimeMs: this._playbackTimeMs,\n      bufferLevel: this._bufferLevel,\n      sampleRate: this.audioContext?.sampleRate,\n      volume: this.gainNode?.gain.value,\n    };\n  }\n\n  // ════════════════════════════════════════════════════════════════\n  //  LIFECYCLE\n  // ════════════════════════════════════════════════════════════════\n\n  /**\n   * Destroy the engine and release all resources.\n   */\n  destroy() {\n    if (this._destroyed) return;\n    this._destroyed = true;\n\n    this.stopAnalysis();\n    this._disconnectSources();\n\n    try { this.workletNode?.disconnect(); } catch {}\n    try { this.analyserNode?.disconnect(); } catch {}\n    try { this.gainNode?.disconnect(); } catch {}\n\n    // Only close context if we created it\n    if (this.audioContext?.state !== 'closed') {\n      this.audioContext?.close().catch(() => {});\n    }\n\n    this.workletNode = null;\n    this.analyserNode = null;\n    this.gainNode = null;\n    this.analyzer = null;\n    this.audioContext = null;\n    this._initialized = false;\n\n    this.removeAllListeners();\n    this.emit('destroyed');\n  }\n\n  /** @private */\n  _ensureInitialized() {\n    if (!this._initialized) {\n      throw new Error('LipSyncEngine not initialized. Call init() first.');\n    }\n  }\n}\n","/**\n * SVGMouthRenderer — Procedural SVG mouth animation driven by viseme shape parameters.\n *\n * Renders an animated mouth using SVG path elements, driven by the\n * {open, width, round} shape parameters from the FrequencyAnalyzer.\n *\n * No sprite sheet required — fully procedural.\n *\n * @module SVGMouthRenderer\n *\n * @example\n *   const mouth = new SVGMouthRenderer(svgContainer, {\n *     width: 120,\n *     height: 80,\n *     lipColor: '#d44',\n *     teethColor: '#fff',\n *   });\n *\n *   engine.on('viseme', (frame) => mouth.render(frame));\n */\n\nexport class SVGMouthRenderer {\n  /**\n   * @param {HTMLElement} container - DOM element to append the SVG into.\n   * @param {Object} [options]\n   * @param {number} [options.width=120]\n   * @param {number} [options.height=80]\n   * @param {string} [options.lipColor='#cc4444']\n   * @param {string} [options.innerColor='#3a1111']\n   * @param {string} [options.teethColor='#ffffff']\n   * @param {boolean} [options.showTeeth=true]\n   * @param {number} [options.lipThickness=3]\n   */\n  constructor(container, options = {}) {\n    this.container = container;\n    this.opts = {\n      width: 120,\n      height: 80,\n      lipColor: '#cc4444',\n      innerColor: '#3a1111',\n      teethColor: '#ffffff',\n      showTeeth: true,\n      lipThickness: 3,\n      ...options,\n    };\n\n    this._createSVG();\n    this._lastShape = { open: 0, width: 0.5, round: 0 };\n  }\n\n  /** @private Create the SVG structure. */\n  _createSVG() {\n    const ns = 'http://www.w3.org/2000/svg';\n    const { width, height } = this.opts;\n\n    this.svg = document.createElementNS(ns, 'svg');\n    this.svg.setAttribute('viewBox', `0 0 ${width} ${height}`);\n    this.svg.setAttribute('width', width);\n    this.svg.setAttribute('height', height);\n    this.svg.style.overflow = 'visible';\n\n    // Inner mouth (dark cavity)\n    this.innerPath = document.createElementNS(ns, 'path');\n    this.innerPath.setAttribute('fill', this.opts.innerColor);\n\n    // Teeth (upper row)\n    this.teethPath = document.createElementNS(ns, 'path');\n    this.teethPath.setAttribute('fill', this.opts.teethColor);\n    this.teethPath.setAttribute('opacity', '0.9');\n\n    // Lip outline\n    this.lipPath = document.createElementNS(ns, 'path');\n    this.lipPath.setAttribute('fill', 'none');\n    this.lipPath.setAttribute('stroke', this.opts.lipColor);\n    this.lipPath.setAttribute('stroke-width', this.opts.lipThickness);\n    this.lipPath.setAttribute('stroke-linecap', 'round');\n    this.lipPath.setAttribute('stroke-linejoin', 'round');\n\n    this.svg.appendChild(this.innerPath);\n    if (this.opts.showTeeth) {\n      this.svg.appendChild(this.teethPath);\n    }\n    this.svg.appendChild(this.lipPath);\n\n    this.container.appendChild(this.svg);\n\n    // Initial render (closed mouth)\n    this._renderShape({ open: 0, width: 0.5, round: 0 });\n  }\n\n  /**\n   * Render a viseme frame.\n   * @param {import('../analyzers/FrequencyAnalyzer.js').VisemeFrame} frame\n   */\n  render(frame) {\n    if (!frame.shape) return;\n    this._renderShape(frame.shape, frame.intensity);\n  }\n\n  /**\n   * Directly set mouth shape parameters.\n   * @param {{open: number, width: number, round: number}} shape\n   * @param {number} [intensity=0.5]\n   */\n  _renderShape(shape, intensity = 0.5) {\n    const { width: svgW, height: svgH } = this.opts;\n    const cx = svgW / 2;\n    const cy = svgH / 2;\n\n    // Map shape params to pixel dimensions\n    const mouthWidth = svgW * 0.3 + svgW * 0.5 * shape.width * (1 - shape.round * 0.4);\n    const mouthHeight = Math.max(1, svgH * 0.7 * shape.open);\n    const cornerRadius = shape.round * mouthWidth * 0.4;\n\n    const halfW = mouthWidth / 2;\n    const halfH = mouthHeight / 2;\n\n    // Control points for bezier curves\n    const cpx = halfW * (0.6 + shape.round * 0.3); // horizontal control\n    const cpy = halfH * (0.8 + shape.open * 0.2);  // vertical control\n\n    // Upper lip path\n    const upperLip = [\n      `M ${cx - halfW} ${cy}`,\n      `C ${cx - cpx} ${cy - cpy}, ${cx + cpx} ${cy - cpy}, ${cx + halfW} ${cy}`,\n    ].join(' ');\n\n    // Lower lip path\n    const lowerLip = [\n      `M ${cx - halfW} ${cy}`,\n      `C ${cx - cpx} ${cy + cpy}, ${cx + cpx} ${cy + cpy}, ${cx + halfW} ${cy}`,\n    ].join(' ');\n\n    // Combined lip outline\n    this.lipPath.setAttribute('d', `${upperLip} ${lowerLip}`);\n\n    // Inner mouth (filled cavity)\n    if (shape.open > 0.02) {\n      const innerScale = 0.85;\n      const iHalfW = halfW * innerScale;\n      const iHalfH = halfH * innerScale;\n      const icpx = cpx * innerScale;\n      const icpy = cpy * innerScale;\n\n      const innerD = [\n        `M ${cx - iHalfW} ${cy}`,\n        `C ${cx - icpx} ${cy - icpy}, ${cx + icpx} ${cy - icpy}, ${cx + iHalfW} ${cy}`,\n        `C ${cx + icpx} ${cy + icpy}, ${cx - icpx} ${cy + icpy}, ${cx - iHalfW} ${cy}`,\n        'Z',\n      ].join(' ');\n      this.innerPath.setAttribute('d', innerD);\n      this.innerPath.setAttribute('opacity', Math.min(1, shape.open * 2));\n    } else {\n      this.innerPath.setAttribute('d', '');\n      this.innerPath.setAttribute('opacity', '0');\n    }\n\n    // Teeth\n    if (this.opts.showTeeth && shape.open > 0.1) {\n      const teethW = halfW * 0.7;\n      const teethH = Math.min(halfH * 0.3, 8);\n      const teethY = cy - halfH * 0.3;\n      const teethD = [\n        `M ${cx - teethW} ${teethY}`,\n        `Q ${cx} ${teethY + teethH}, ${cx + teethW} ${teethY}`,\n        `L ${cx + teethW} ${teethY + teethH * 0.5}`,\n        `Q ${cx} ${teethY + teethH * 1.3}, ${cx - teethW} ${teethY + teethH * 0.5}`,\n        'Z',\n      ].join(' ');\n      this.teethPath.setAttribute('d', teethD);\n      this.teethPath.setAttribute('opacity', Math.min(0.9, shape.open * 1.5));\n    } else {\n      this.teethPath.setAttribute('d', '');\n      this.teethPath.setAttribute('opacity', '0');\n    }\n\n    this._lastShape = { ...shape };\n  }\n\n  /**\n   * Update renderer options dynamically.\n   * @param {Object} opts\n   */\n  updateOptions(opts) {\n    Object.assign(this.opts, opts);\n    if (opts.lipColor) this.lipPath.setAttribute('stroke', opts.lipColor);\n    if (opts.innerColor) this.innerPath.setAttribute('fill', opts.innerColor);\n    if (opts.teethColor) this.teethPath.setAttribute('fill', opts.teethColor);\n    if (opts.lipThickness) this.lipPath.setAttribute('stroke-width', opts.lipThickness);\n  }\n\n  /** Remove SVG from DOM and clean up. */\n  destroy() {\n    this.svg?.remove();\n    this.svg = null;\n  }\n}\n","/**\n * CanvasRenderer — Renders lip-sync visemes using a sprite sheet on Canvas 2D.\n *\n * Expects a sprite sheet image where each viseme is a fixed-size frame\n * arranged in a grid or strip.\n *\n * @module CanvasRenderer\n *\n * @example\n *   const renderer = new CanvasRenderer(canvas, {\n *     spriteSheet: mouthSprites,       // Image or URL\n *     frameWidth: 128,\n *     frameHeight: 128,\n *     visemeMap: { sil: 0, PP: 1, FF: 2, ... }\n *   });\n *\n *   engine.on('viseme', (frame) => renderer.render(frame));\n */\n\nexport class CanvasRenderer {\n  /**\n   * @param {HTMLCanvasElement} canvas\n   * @param {Object} options\n   * @param {HTMLImageElement|string} options.spriteSheet - Sprite sheet image or URL.\n   * @param {number} options.frameWidth - Width of each frame in the sprite sheet.\n   * @param {number} options.frameHeight - Height of each frame.\n   * @param {Object<string, number>} options.visemeMap - Maps viseme keys to frame indices.\n   * @param {number} [options.columns] - Columns in sprite sheet (auto-calculated if omitted).\n   * @param {number} [options.offsetX=0] - X offset for rendering on canvas.\n   * @param {number} [options.offsetY=0] - Y offset for rendering on canvas.\n   * @param {number} [options.scale=1] - Render scale.\n   * @param {boolean} [options.clearBeforeRender=true]\n   */\n  constructor(canvas, options) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d');\n    this.opts = {\n      offsetX: 0,\n      offsetY: 0,\n      scale: 1,\n      clearBeforeRender: true,\n      ...options,\n    };\n\n    /** @type {HTMLImageElement|null} */\n    this.spriteSheet = null;\n    this._ready = false;\n    this._currentFrame = 0;\n    this._targetFrame = 0;\n    this._blendProgress = 1;\n\n    this._loadSpriteSheet(options.spriteSheet);\n  }\n\n  /** @private */\n  async _loadSpriteSheet(source) {\n    if (source instanceof HTMLImageElement) {\n      this.spriteSheet = source;\n      if (source.complete) {\n        this._ready = true;\n      } else {\n        await new Promise((resolve) => {\n          source.onload = resolve;\n        });\n        this._ready = true;\n      }\n    } else if (typeof source === 'string') {\n      this.spriteSheet = new Image();\n      this.spriteSheet.src = source;\n      await new Promise((resolve, reject) => {\n        this.spriteSheet.onload = resolve;\n        this.spriteSheet.onerror = reject;\n      });\n      this._ready = true;\n    }\n\n    // Auto-detect columns\n    if (!this.opts.columns && this.spriteSheet) {\n      this.opts.columns = Math.floor(\n        this.spriteSheet.naturalWidth / this.opts.frameWidth\n      );\n    }\n  }\n\n  /**\n   * Render a viseme frame to the canvas.\n   * @param {import('../analyzers/FrequencyAnalyzer.js').VisemeFrame} frame\n   */\n  render(frame) {\n    if (!this._ready || !this.spriteSheet) return;\n\n    const frameIndex = this.opts.visemeMap[frame.viseme] ?? this.opts.visemeMap.sil ?? 0;\n    const cols = this.opts.columns || 1;\n    const row = Math.floor(frameIndex / cols);\n    const col = frameIndex % cols;\n\n    const sx = col * this.opts.frameWidth;\n    const sy = row * this.opts.frameHeight;\n\n    if (this.opts.clearBeforeRender) {\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    const dw = this.opts.frameWidth * this.opts.scale;\n    const dh = this.opts.frameHeight * this.opts.scale;\n\n    this.ctx.drawImage(\n      this.spriteSheet,\n      sx, sy, this.opts.frameWidth, this.opts.frameHeight,\n      this.opts.offsetX, this.opts.offsetY, dw, dh\n    );\n  }\n\n  /** Destroy and release canvas reference. */\n  destroy() {\n    this.spriteSheet = null;\n    this._ready = false;\n  }\n}\n","/**\n * CSSClassRenderer — Applies CSS classes to an element based on viseme state.\n *\n * Perfect for CSS sprite animations, Lottie triggers, or any framework\n * where you toggle classes/data-attributes to change mouth appearance.\n *\n * @module CSSClassRenderer\n *\n * @example\n *   // CSS:\n *   // .mouth[data-viseme=\"sil\"] { background-position: 0 0; }\n *   // .mouth[data-viseme=\"aa\"]  { background-position: -128px 0; }\n *\n *   const renderer = new CSSClassRenderer(mouthElement, {\n *     attribute: 'data-viseme',    // Set data attribute\n *     classPrefix: 'mouth-',       // Also toggle class: mouth-sil, mouth-aa, etc.\n *     useSimpleVisemes: true,      // Use A-F instead of extended set\n *   });\n *\n *   engine.on('viseme', (frame) => renderer.render(frame));\n */\n\nexport class CSSClassRenderer {\n  /**\n   * @param {HTMLElement} element - Target DOM element.\n   * @param {Object} [options]\n   * @param {string} [options.attribute='data-viseme'] - Data attribute to set.\n   * @param {string} [options.classPrefix=''] - If set, toggles CSS classes.\n   * @param {boolean} [options.useSimpleVisemes=false] - Use simple (A-F) viseme keys.\n   * @param {string} [options.intensityAttribute='data-intensity'] - Attribute for intensity.\n   * @param {boolean} [options.setIntensity=true] - Whether to set intensity attribute.\n   * @param {Object<string, string>} [options.visemeClassMap] - Custom viseme → class mapping.\n   */\n  constructor(element, options = {}) {\n    this.element = element;\n    this.opts = {\n      attribute: 'data-viseme',\n      classPrefix: '',\n      useSimpleVisemes: false,\n      intensityAttribute: 'data-intensity',\n      setIntensity: true,\n      visemeClassMap: null,\n      ...options,\n    };\n\n    this._currentClass = null;\n    this._currentViseme = null;\n  }\n\n  /**\n   * Apply viseme state to the element.\n   * @param {import('../analyzers/FrequencyAnalyzer.js').VisemeFrame} frame\n   */\n  render(frame) {\n    const viseme = this.opts.useSimpleVisemes ? frame.simpleViseme : frame.viseme;\n\n    if (viseme !== this._currentViseme) {\n      // Update attribute\n      this.element.setAttribute(this.opts.attribute, viseme);\n\n      // Update CSS class\n      if (this.opts.classPrefix) {\n        if (this._currentClass) {\n          this.element.classList.remove(this._currentClass);\n        }\n        const mapped = this.opts.visemeClassMap?.[viseme];\n        this._currentClass = mapped || `${this.opts.classPrefix}${viseme}`;\n        this.element.classList.add(this._currentClass);\n      }\n\n      this._currentViseme = viseme;\n    }\n\n    // Update intensity\n    if (this.opts.setIntensity) {\n      const level = Math.round(frame.intensity * 100);\n      this.element.setAttribute(this.opts.intensityAttribute, level);\n      this.element.style.setProperty('--lip-intensity', frame.intensity);\n      this.element.style.setProperty('--lip-open', frame.shape?.open ?? 0);\n      this.element.style.setProperty('--lip-width', frame.shape?.width ?? 0.5);\n      this.element.style.setProperty('--lip-round', frame.shape?.round ?? 0);\n    }\n  }\n\n  /** Remove classes and attributes from element. */\n  destroy() {\n    if (this._currentClass) {\n      this.element.classList.remove(this._currentClass);\n    }\n    this.element.removeAttribute(this.opts.attribute);\n    this.element.removeAttribute(this.opts.intensityAttribute);\n    this._currentViseme = null;\n  }\n}\n","/**\n * Lock-free ring buffer for Float32 audio samples.\n * Designed for use inside an AudioWorkletProcessor where\n * allocations must be avoided in the process() hot path.\n *\n * @module RingBuffer\n */\nexport class RingBuffer {\n  /**\n   * @param {number} capacity - Maximum number of Float32 samples.\n   */\n  constructor(capacity) {\n    /** @type {Float32Array} */\n    this.buffer = new Float32Array(capacity);\n    /** @type {number} */\n    this.capacity = capacity;\n    /** @type {number} */\n    this.readPtr = 0;\n    /** @type {number} */\n    this.writePtr = 0;\n    /** @type {number} */\n    this.available = 0;\n  }\n\n  /** Number of samples that can be read. */\n  get length() {\n    return this.available;\n  }\n\n  /** Number of samples that can be written before overflow. */\n  get free() {\n    return this.capacity - this.available;\n  }\n\n  /** Whether the buffer is completely empty. */\n  get empty() {\n    return this.available === 0;\n  }\n\n  /** Whether the buffer is completely full. */\n  get full() {\n    return this.available === this.capacity;\n  }\n\n  /** Fill level as a fraction 0..1. */\n  get level() {\n    return this.available / this.capacity;\n  }\n\n  /**\n   * Write samples into the buffer.\n   * @param {Float32Array} samples\n   * @returns {number} Number of samples actually written.\n   */\n  write(samples) {\n    const toWrite = Math.min(samples.length, this.free);\n    for (let i = 0; i < toWrite; i++) {\n      this.buffer[this.writePtr] = samples[i];\n      this.writePtr = (this.writePtr + 1) % this.capacity;\n    }\n    this.available += toWrite;\n    return toWrite;\n  }\n\n  /**\n   * Write samples, overwriting oldest data if full.\n   * @param {Float32Array} samples\n   * @returns {number} Number of samples overwritten.\n   */\n  writeOverflow(samples) {\n    let overwritten = 0;\n    for (let i = 0; i < samples.length; i++) {\n      if (this.available >= this.capacity) {\n        // Overwrite oldest\n        this.readPtr = (this.readPtr + 1) % this.capacity;\n        overwritten++;\n      } else {\n        this.available++;\n      }\n      this.buffer[this.writePtr] = samples[i];\n      this.writePtr = (this.writePtr + 1) % this.capacity;\n    }\n    return overwritten;\n  }\n\n  /**\n   * Read samples from the buffer into the target array.\n   * @param {Float32Array} target - Destination array.\n   * @param {number} [offset=0] - Starting offset in target.\n   * @param {number} [count] - Samples to read (defaults to target.length - offset).\n   * @returns {number} Number of samples actually read.\n   */\n  read(target, offset = 0, count) {\n    const toRead = Math.min(count ?? (target.length - offset), this.available);\n    for (let i = 0; i < toRead; i++) {\n      target[offset + i] = this.buffer[this.readPtr];\n      this.readPtr = (this.readPtr + 1) % this.capacity;\n    }\n    this.available -= toRead;\n    return toRead;\n  }\n\n  /**\n   * Read a single sample. Returns 0 if empty.\n   * @returns {number}\n   */\n  readOne() {\n    if (this.available === 0) return 0;\n    const sample = this.buffer[this.readPtr];\n    this.readPtr = (this.readPtr + 1) % this.capacity;\n    this.available--;\n    return sample;\n  }\n\n  /**\n   * Peek at samples without consuming them.\n   * @param {number} count\n   * @returns {Float32Array}\n   */\n  peek(count) {\n    const n = Math.min(count, this.available);\n    const result = new Float32Array(n);\n    let ptr = this.readPtr;\n    for (let i = 0; i < n; i++) {\n      result[i] = this.buffer[ptr];\n      ptr = (ptr + 1) % this.capacity;\n    }\n    return result;\n  }\n\n  /** Discard all data. */\n  clear() {\n    this.readPtr = 0;\n    this.writePtr = 0;\n    this.available = 0;\n  }\n}\n","/**\n * @beer-digital/lipsync-engine\n *\n * Production-grade, renderer-agnostic streaming lip-sync engine for\n * browser-based 2D animation. Real-time viseme detection from streaming\n * audio via AudioWorklet + Web Audio API.\n *\n * @example\n *   import {\n *     LipSyncEngine,\n *     SVGMouthRenderer,\n *     base64ToInt16,\n *   } from '@beer-digital/lipsync-engine';\n *\n *   const engine = new LipSyncEngine({ sampleRate: 24000 });\n *   const mouth = new SVGMouthRenderer(document.getElementById('mouth'));\n *\n *   await engine.init();\n *   engine.on('viseme', (frame) => mouth.render(frame));\n *   engine.startAnalysis();\n *\n *   // Feed audio from TTS API\n *   engine.feedAudio(base64ToInt16(audioChunk));\n *\n * @module @beer-digital/lipsync-engine\n */\n\n// ── Core ─────────────────────────────────────────────────────────\nexport { LipSyncEngine } from './core/LipSyncEngine.js';\n\n// ── Analyzers ────────────────────────────────────────────────────\nexport { FrequencyAnalyzer } from './analyzers/FrequencyAnalyzer.js';\n\n// ── Renderers ────────────────────────────────────────────────────\nexport { SVGMouthRenderer } from './renderers/SVGMouthRenderer.js';\nexport { CanvasRenderer } from './renderers/CanvasRenderer.js';\nexport { CSSClassRenderer } from './renderers/CSSClassRenderer.js';\n\n// ── Viseme data ──────────────────────────────────────────────────\nexport {\n  EXTENDED_VISEMES,\n  EXTENDED_VISEME_KEYS,\n  SIMPLE_VISEMES,\n  SIMPLE_VISEME_KEYS,\n  EXTENDED_TO_SIMPLE,\n  PHONEME_TO_VISEME,\n  ARPABET_PHONEMES,\n  VISEME_SHAPES,\n  TRANSITION_WEIGHTS,\n  getTransitionWeight,\n  interpolateShapes,\n} from './core/visemes.js';\n\n// ── Utilities ────────────────────────────────────────────────────\nexport {\n  int16ToFloat32,\n  float32ToInt16,\n  base64ToInt16,\n  int16ToBase64,\n  calculateRMS,\n  zeroCrossingRate,\n  extractBandEnergies,\n  smoothValue,\n  lerp,\n  clamp,\n  resample,\n} from './utils/audio-utils.js';\n\nexport { EventEmitter } from './utils/EventEmitter.js';\nexport { RingBuffer } from './utils/RingBuffer.js';\n\n// ── Version ──────────────────────────────────────────────────────\nexport const VERSION = '1.0.0';\n"],"names":["DEFAULTS"],"mappings":"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"}